<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>神奇的Shadow DOM | kaelyn</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">神奇的Shadow DOM</h1><a id="logo" href="/.">kaelyn</a><p class="description">kaelyn's blog</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">神奇的Shadow DOM</h1><div class="post-meta">Nov 23, 2017<span> | </span><span class="category"><a href="/categories/前端/">前端</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#怎样创建Shadow-DOM"><span class="toc-number">2.</span> <span class="toc-text">怎样创建Shadow DOM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#想要渲染影子宿主里的内容，那该怎么玩？"><span class="toc-number">3.</span> <span class="toc-text">想要渲染影子宿主里的内容，那该怎么玩？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-content-gt"><span class="toc-number">3.1.</span> <span class="toc-text">&lt;content&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-template-gt"><span class="toc-number">3.2.</span> <span class="toc-text">&lt;template&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例"><span class="toc-number">3.3.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关于样式"><span class="toc-number">4.</span> <span class="toc-text">关于样式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#宿主样式-host"><span class="toc-number">4.1.</span> <span class="toc-text">宿主样式 :host</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shadow"><span class="toc-number">4.2.</span> <span class="toc-text">::shadow</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deep"><span class="toc-number">4.3.</span> <span class="toc-text">/deep/</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#content"><span class="toc-number">4.4.</span> <span class="toc-text">::content</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例-1"><span class="toc-number">4.5.</span> <span class="toc-text">实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript"><span class="toc-number">5.</span> <span class="toc-text">JavaScript</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#重定向"><span class="toc-number">5.1.</span> <span class="toc-text">重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#被阻塞的事件（Blocked-Events）"><span class="toc-number">5.2.</span> <span class="toc-text">被阻塞的事件（Blocked Events）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#兼容性"><span class="toc-number">6.</span> <span class="toc-text">兼容性</span></a></li></ol></div></div><div class="post-content"><p><center><img src="http://img.blog.csdn.net/20171123224839462" alt="shadowDOM"></center><br>&emsp;&emsp;你有好奇过这个问题吗，为什么只用 video 标签包裹着 source 标签，就可以完成一系列视频功能：播放/暂停按钮、进度条、视频时间显示、音量控制等等？既然 DOM 源码这么干净，你有想过实现这些组件的代码是从哪儿来的吗？</p>
<hr>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>&emsp;&emsp;<strong>Shadow DOM</strong> 它允许在文档（document）渲染时插入一棵 <strong>DOM 元素子树</strong>，但是这棵子树<strong>不在</strong>主DOM树中。<br>&emsp;&emsp;因此开发者可利用 Shadow DOM <strong>封装</strong>自己的 HTML 标签、CSS 样式和 JavaScript 代码。<br>&emsp;&emsp;看一个简单的 video：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Shadow DOM&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;video controls autoplay name=&quot;media&quot; width=&quot;500&quot;&gt;</span><br><span class="line">    &lt;source id=&quot;mp4&quot; src=&quot;http://7ryl2t.com2.z0.glb.qiniucdn.com/572ffc37a2e5a.mp4&quot; type=&quot;video/mp4&quot;&gt;</span><br><span class="line">&lt;/video&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;页面完成了，在浏览器chrome中打开，然后打开 Chrome 的开发者工具，点击右上角的“<strong>Settings</strong>”按钮，勾选“<strong>Show user agent shadow DOM</strong>”。</p>
<p><center><img src="http://img.blog.csdn.net/20171123225653441" alt="开启显示shadowDOM"></center><br>&emsp;&emsp;浏览器截图：</p>
<p><center><img src="http://img.blog.csdn.net/20171123225816038" alt="video"></center><br>&emsp;&emsp;<strong>#shadow-root</strong> 称为<strong>影子根</strong>，可以看到它在 video 里面，换句话说，#shadow-root <strong>寄生</strong>在 video 上，所以 video 此时称为<strong>影子宿主</strong>。可以看到上图有两个 #shadow-root，这是因为 #shadow-root 可以<strong>嵌套</strong>，形成<strong>节点树</strong>，即称为<strong>影子树（shadow trees）</strong>。影子树对其中的内容进行了<strong>封装</strong>，<strong>有选择性的进行渲染</strong>。这就意味着我们可以插入文本、重新安排内容、添加样式等等。如下所示：<br><img src="http://img.blog.csdn.net/20171123230011416" alt="shadow tree"></p>
<hr>
<h2 id="怎样创建Shadow-DOM"><a href="#怎样创建Shadow-DOM" class="headerlink" title="怎样创建Shadow DOM"></a>怎样创建Shadow DOM</h2><p>&emsp;&emsp;使用createShadowRoot()来创建Shadow DOM，并赋值给一个变量，然后添加元素给变量即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Shadow DOM&lt;/title&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">        .shadowroot_son &#123;</span><br><span class="line">            color: #f00;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;shadowhost&quot;&gt;Hello, world!&lt;/div&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        // 影子宿主（shadow host）</span><br><span class="line">        var shadowHost = document.querySelector(&apos;.shadowhost&apos;);</span><br><span class="line">        // 创建影子根（shadow root）</span><br><span class="line">        var shadowRoot = shadowHost.createShadowRoot();</span><br><span class="line">        // 影子根作为影子树的第一个节点，其他的节点比如p节点都是它的子节点。</span><br><span class="line">        shadowRoot.innerHTML = &apos;&lt;p class=&quot;shadowroot_son&quot;&gt;夏天夏天悄悄过去留下小秘密！&lt;/p&gt;&apos;;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;浏览器截图：<br>&emsp;&emsp;&emsp;&emsp;<img src="http://img.blog.csdn.net/20171123230154167" alt="初次创建 shadow DOM"><br>&emsp;&emsp;有没有注意到 .shadowroot_son 的样式 <code>color: #f00;</code> <strong>不生效</strong>？！那是因为影子宿主和影子根之间存在<strong>影子边界（shadow boundary）</strong>，影子边界保证主 DOM 写的 CSS 选择器和 JavaScript 代码都不会影响到 Shadow DOM，当然也<strong>保护主文档不受 shadow DOM 样式的侵袭</strong>。</p>
<hr>
<h2 id="想要渲染影子宿主里的内容，那该怎么玩？"><a href="#想要渲染影子宿主里的内容，那该怎么玩？" class="headerlink" title="想要渲染影子宿主里的内容，那该怎么玩？"></a>想要渲染影子宿主里的内容，那该怎么玩？</h2><p>&emsp;&emsp;需要完成此项任务，需要两个利器：<code>&lt;content&gt;</code>和<code>&lt;template&gt;</code>。</p>
<h3 id="lt-content-gt"><a href="#lt-content-gt" class="headerlink" title="&lt;content&gt;"></a><code>&lt;content&gt;</code></h3><p>&emsp;&emsp;通过 <code>&lt;content&gt;</code> 标签把来自主文档并添加到 shadow DOM 的内容被称为<strong>分布节点</strong>。<br>&emsp;&emsp;<code>&lt;content&gt;</code>的 <strong>select</strong> 属性告诉<code>&lt;content&gt;</code>标签有选择性的插入内容。select 属性使用 CSS 选择器来选取想要展示的内容，选择器包括类选择器、元素选择器等。<br><br></p>
<h3 id="lt-template-gt"><a href="#lt-template-gt" class="headerlink" title="&lt;template&gt;"></a><code>&lt;template&gt;</code></h3><p>&emsp;&emsp;目前的模板 HTML做法通常是在<code>&lt;script&gt;</code> 中嵌入模板 HTML，让内部的 HTML 标签按照<strong>字符串</strong>处理的，从而使得内容不显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/template&quot;&gt;</span><br><span class="line">// ...</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;<code>&lt;template&gt;</code>元素的出现旨在让 HTML 模板变得更加标准与规范。<br>&emsp;&emsp;<code>&lt;template&gt;</code>在使用前不会被渲染，不会执行加载等操作，也能够实现隐藏标签内容，而且位置任意性，可以在<code>&lt;head&gt;</code>中，也可以在<code>&lt;body&gt;</code>或者<code>&lt;frameset&gt;</code>中。<br><br></p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>&emsp;&emsp;通过以上对 <code>&lt;content&gt;</code>和<code>&lt;template&gt;</code>的简单了解，我们来通过一个实例加深理解：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;content&amp;template&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;shadowhost&quot;&gt;</span><br><span class="line">        &lt;em class=&quot;shadowhost_content1&quot;&gt;唱歌&lt;/em&gt;</span><br><span class="line">        &lt;em class=&quot;shadowhost_content2&quot;&gt;跳舞&lt;/em&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- S 模板标签 template --&gt;</span><br><span class="line">    &lt;template class=&quot;template&quot;&gt;</span><br><span class="line">        &lt;h1&gt;你&lt;content select=&quot;.shadowhost_content1&quot;&gt;&lt;/content&gt;我&lt;content select=&quot;.shadowhost_content2&quot;&gt;&lt;/content&gt;!&lt;/h1&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;!-- E 模板标签 template --&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    var shadowHost = document.querySelector(&apos;.shadowhost&apos;);</span><br><span class="line">    var shadowRoot = shadowHost.createShadowRoot();</span><br><span class="line">    var template = document.querySelector(&apos;.template&apos;);</span><br><span class="line">    // template.content会返回一个文档片段，可以理解为另外一个document。</span><br><span class="line">    // 利用document.importNode获取节点，true表示深度克隆。</span><br><span class="line">    shadowRoot.appendChild(document.importNode(template.content, true));</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;浏览器截图：<br>&emsp;&emsp;&emsp;&emsp;<img src="http://img.blog.csdn.net/20171123232114256" alt="渲染影子宿主内容"></p>
<hr>
<h2 id="关于样式"><a href="#关于样式" class="headerlink" title="关于样式"></a>关于样式</h2><h3 id="宿主样式-host"><a href="#宿主样式-host" class="headerlink" title="宿主样式 :host"></a>宿主样式 :host</h3><p>&emsp;&emsp;在 shadow DOM 中利用 <strong>:host</strong> 定义宿主的样式，当然用户可以在主文档中覆盖这个样式。<br>&emsp;&emsp;:host 是<strong>伪类选择器（Pseudo Selector）</strong>，:host 或者 :host(*) 是默认给所有的宿主添加样式，或者单独给一个宿主添加样式，即通过:host(x)，x可以是宿主的标签或者类选择器等。<br>&emsp;&emsp;另外 :host 还可以配合 :hover、:active 等状态来设置样式，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:host(:hover) &#123;</span><br><span class="line">    border: 2px solid #0ff;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h3 id="shadow"><a href="#shadow" class="headerlink" title="::shadow"></a>::shadow</h3><p>&emsp;&emsp;原则上来说，<strong>影子边界</strong>保证主 DOM写的 CSS 选择器和 JavaScript 代码都不会影响到 Shadow DOM。<br>&emsp;&emsp;但你可能会想打破影子边界的所谓保证，主文档能够给Shadow DOM添加一些样式，这时可以使用 <strong>::shadow</strong>。<br><br></p>
<h3 id="deep"><a href="#deep" class="headerlink" title="/deep/"></a>/deep/</h3><p>&emsp;&emsp;::shadow 选择器的一个缺陷是他只能穿透<strong>一层</strong>影子边界，如果你在一个影子树中<strong>嵌套</strong>了多个影子树，那么使用 /deep/ 。<br><br></p>
<h3 id="content"><a href="#content" class="headerlink" title="::content"></a>::content</h3><p>&emsp;&emsp;还记得什么叫<strong>分布节点</strong>吗？通过 <code>&lt;content&gt;</code> 标签把来自主文档并添加到 shadow DOM 的内容被称为分布节点。<br>&emsp;&emsp;分布节点的样式渲染需要用到 <strong>::content</strong>。即使分布节点为 <strong>em 标签</strong>，直接写 em {} 不生效，应该写成::content &gt; em {}。<br><br></p>
<h3 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;::content&amp;::shadow&amp;/deep/&lt;/title&gt;</span><br><span class="line">    &lt;style type=&quot;text/css&quot;&gt;</span><br><span class="line">    /* ::shadow */</span><br><span class="line">    /*.shadowhost::shadow h1 &#123;</span><br><span class="line">        padding: 20px;</span><br><span class="line">        border: 1px solid #f00;</span><br><span class="line">    &#125;*/</span><br><span class="line">    /* /deep/  */</span><br><span class="line">    .shadowhost /deep/ h1 &#123;</span><br><span class="line">        padding: 20px;</span><br><span class="line">        border: 1px solid #000;</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;shadowhost&quot;&gt;</span><br><span class="line">        &lt;em class=&quot;shadowhost_content1&quot;&gt;唱歌&lt;/em&gt;</span><br><span class="line">        &lt;em class=&quot;shadowhost_content2&quot;&gt;跳舞&lt;/em&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- S 模板标签 template --&gt;</span><br><span class="line">    &lt;template class=&quot;template&quot;&gt;</span><br><span class="line">        &lt;style&gt;</span><br><span class="line">        /* 定义宿主样式:host */</span><br><span class="line">        :host &#123;</span><br><span class="line">            color: #E85E5E;</span><br><span class="line">        &#125;</span><br><span class="line">        /* 定义宿主hover状态下的样式 */</span><br><span class="line">        :host(:hover) &#123;</span><br><span class="line">            color: #000;</span><br><span class="line">        &#125;</span><br><span class="line">        /* 分布节点的样式渲染需要用到 ::content,直接写 em &#123;&#125; 不生效 */</span><br><span class="line">        ::content &gt; em &#123;</span><br><span class="line">            padding: 10px;</span><br><span class="line">            color: #fff;</span><br><span class="line">            background: #FFCC00;</span><br><span class="line">            border-radius: 10px;</span><br><span class="line">        &#125;</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">        &lt;h1&gt;你&lt;content select=&quot;.shadowhost_content1&quot;&gt;&lt;/content&gt;我&lt;content select=&quot;.shadowhost_content2&quot;&gt;&lt;/content&gt;!&lt;/h1&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;!-- E 模板标签 template --&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    var shadowHost = document.querySelector(&apos;.shadowhost&apos;);</span><br><span class="line">    var shadowRoot = shadowHost.createShadowRoot();</span><br><span class="line">    var template = document.querySelector(&apos;.template&apos;);</span><br><span class="line">    shadowRoot.appendChild(document.importNode(template.content, true));</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;浏览器截图如下：<br>&emsp;&emsp;&emsp;&emsp;<img src="http://img.blog.csdn.net/20171123233242422" alt="样式"></p>
<hr>
<h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>&emsp;&emsp;Shadow DOM 里的 JS 与传统的 JS 一个真正不同的点在于<strong>事件调度（event dispatching）</strong>。要记住的一点是：原来绑定在 shadow DOM 节点中的事件<strong>被重定向</strong>了，所以他们看起来<strong>像绑定在影子宿主上一样</strong>。<br>&emsp;&emsp;当你点击“shadow text”的输入框时控制台却输出了宿主元素（就是 #host）的 id 。这是因为影子节点上的事件必须重定向，否则这将破坏封装性。<br>&emsp;&emsp;分布节点来自原有 DOM 结构，没必要重定向。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;select&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;input id=&quot;normal-text&quot; type=&quot;text&quot; value=&quot;I&apos;m normal text&quot;&gt;</span><br><span class="line">  &lt;div id=&quot;host&quot;&gt;</span><br><span class="line">    &lt;!-- “dustributed text”为分布节点，来自原有 DOM 结构，没必要重定向。 --&gt;</span><br><span class="line">    &lt;input id=&quot;distributed-text&quot; type=&quot;text&quot; value=&quot;I&apos;m distributed text&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input id=&quot;shadow-text&quot; type=&quot;text&quot; value=&quot;I&apos;m shadow text&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;content&gt;&lt;/content&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">  &lt;script&gt;</span><br><span class="line">    var host = document.querySelector(&apos;#host&apos;);</span><br><span class="line">    var root = host.createShadowRoot();</span><br><span class="line">    var template = document.querySelector(&apos;template&apos;);</span><br><span class="line">    root.appendChild(document.importNode(template.content, true));</span><br><span class="line">    document.addEventListener(&apos;click&apos;, function(e) &#123;</span><br><span class="line">      console.log(e.target.id + &apos; click!&apos;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;分别单击每个输入框，控制台打印截图如下：<br>&emsp;&emsp;&emsp;&emsp;<img src="http://img.blog.csdn.net/20171123234018864" alt="重定向"><br><br></p>
<h3 id="被阻塞的事件（Blocked-Events）"><a href="#被阻塞的事件（Blocked-Events）" class="headerlink" title="被阻塞的事件（Blocked Events）"></a>被阻塞的事件（Blocked Events）</h3><p>&emsp;&emsp;事件abort、 error、 select 、change 、load 、reset 、resize 、scroll 、selectstart不会进行重定向而是直接被干掉，因此事件<strong>不能冒泡到文档中</strong>，事件监听重定向至文档，因此<strong>无法监听</strong>到这一事件。<br>&emsp;&emsp;把上面的监听事件click改成select，即改成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">document.addEventListener(&apos;select&apos;, function(e) &#123;</span><br><span class="line">    console.log(e.target.id + &apos; select!&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;分别双击每个输入框，你会发现，shadow text的输入框没有打印，就是没有发生select事件。<br>&emsp;&emsp;&emsp;&emsp;<img src="http://img.blog.csdn.net/20171123234334560" alt="被阻塞的时间"></p>
<hr>
<h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p><center><img src="http://img.blog.csdn.net/20171123234646746" alt="templates 兼容性"></center></p>
<p><center><img src="http://img.blog.csdn.net/20171123234755146" alt="shadow DOM 兼容性"></center><br>&emsp;&emsp;看上去只能在chrome中愉快地玩耍。<br>&emsp;&emsp;<a href="http://webcomponents.org/" target="_blank" rel="noopener">webcomponents.js</a> 使得Shadow DOM在非 native 支持的浏览器上实现。</p>
<p><br></p>
<blockquote>
<p>原文出处：<a href="https://aotu.io/notes/2016/06/24/Shadow-DOM/" target="_blank" rel="noopener">凹凸实验室</a></p>
</blockquote>
</div><div class="tags"><a href="/tags/shadowDOM/">shadowDOM</a><a href="/tags/影子根/">影子根</a><a href="/tags/影子宿主/">影子宿主</a></div><div class="post-nav"><a class="pre" href="/2017/11/24/JavaScript 垃圾收集机制/">JavaScript 垃圾收集机制</a><a class="next" href="/2017/11/23/无缝滚动/">实现无缝滚动</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ES6/">ES6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/css3/">css3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/html5/">html5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/questions/">questions</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue/">vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/函数参数表达/" style="font-size: 15px;">函数参数表达</a> <a href="/tags/css3/" style="font-size: 15px;">css3</a> <a href="/tags/IFC/" style="font-size: 15px;">IFC</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/绝对底部/" style="font-size: 15px;">绝对底部</a> <a href="/tags/StickyFoot/" style="font-size: 15px;">StickyFoot</a> <a href="/tags/图片压缩/" style="font-size: 15px;">图片压缩</a> <a href="/tags/canvas/" style="font-size: 15px;">canvas</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/vuex/" style="font-size: 15px;">vuex</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/hello-world/">hello-world</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/09/hexo-theme/">hexo-theme</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/Vuex的Mutation学习/">Vuex 的 Mutation 学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/Vuex的Action学习/">Vuex 的 Action 学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/25/Vuex的Getter学习/">Vuex 的 Getter 学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/24/Vuex的State学习/">Vuex 的 State 学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/23/vue的混合mixins学习/">vue的混合mixins学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/28/vue+element的upload组件学习模板/">vue+element的upload组件学习模板</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/28/vue+element的tree组件学习模板/">vue+element的tree组件学习模板</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/23/vue+element的table组件学习模板/">vue+element的table组件学习模板</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">kaelyn.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>